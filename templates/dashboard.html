<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AutoPod Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <!-- Splash Screen -->
  <div id="splash-screen" class="splash-screen">
    <div class="splash-content">
      <div class="splash-icon">ğŸš€</div>
      <h1 class="splash-title">AutoPod</h1>
      <p class="splash-subtitle">Intelligent Container Management</p>
      <div class="splash-loader">
        <div class="loader-dot"></div>
        <div class="loader-dot"></div>
        <div class="loader-dot"></div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div id="main-content" class="main-content">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="header-left">
          <div class="logo">
            <span class="logo-icon">ğŸš€</span>
            <h1>AutoPod</h1>
          </div>
          <p class="header-subtitle">Intelligent Container Dashboard</p>
        </div>
        <div class="header-right">
          <div class="status-indicator">
            <span class="status-dot"></span>
            <span class="status-text">System Active</span>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Container -->
    <div class="container">
      <!-- Quick Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">ğŸ“¦</div>
          <div class="stat-content">
            <div class="stat-label">Total Containers</div>
            <div class="stat-value" id="total-containers">0</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">âœ…</div>
          <div class="stat-content">
            <div class="stat-label">Running</div>
            <div class="stat-value" id="running-containers">0</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">â¹ï¸</div>
          <div class="stat-content">
            <div class="stat-label">Stopped</div>
            <div class="stat-value" id="stopped-containers">0</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">âš ï¸</div>
          <div class="stat-content">
            <div class="stat-label">Issues</div>
            <div class="stat-value" id="issue-containers">0</div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <section class="section">
        <div class="section-header">
          <h2>âš¡ Quick Actions</h2>
          <p class="section-subtitle">Manage your containers efficiently</p>
        </div>
        <div class="actions-grid">
          <button class="action-btn primary" onclick="syncContainers()">
            <span class="btn-icon">ğŸ”„</span>
            <span class="btn-text">Sync Containers</span>
          </button>
          <button class="action-btn secondary" onclick="refreshData()">
            <span class="btn-icon">ğŸ“Š</span>
            <span class="btn-text">Refresh Data</span>
          </button>
          <button class="action-btn secondary" onclick="clearLogs()">
            <span class="btn-icon">ğŸ§¹</span>
            <span class="btn-text">Clear Logs</span>
          </button>
          <button class="action-btn success" onclick="testWebhook()">
            <span class="btn-icon">ğŸš€</span>
            <span class="btn-text">Test Webhook</span>
          </button>
        </div>
        <div id="sync-status" class="status-message"></div>
        <div id="last-updated" class="last-updated"></div>
      </section>

      <!-- Deployment Section -->
      <section class="section">
        <div class="section-header">
          <h2>ğŸŒ Deploy from GitHub</h2>
          <p class="section-subtitle">Automatically deploy containers from repositories</p>
        </div>
        <div class="deployment-form">
          <div class="form-group">
            <label for="github-url">Repository URL</label>
            <input 
              type="text" 
              id="github-url" 
              class="form-input" 
              placeholder="https://github.com/username/repository.git"
            >
            <div class="form-hint">Enter any public GitHub repository URL with a Dockerfile</div>
          </div>

          <div class="form-group">
            <label for="app-name">Application Name</label>
            <input 
              type="text" 
              id="app-name" 
              class="form-input" 
              placeholder="my-app"
            >
            <div class="form-hint">Auto-filled from repository name if left empty</div>
          </div>

          <div class="actions-grid">
            <button class="action-btn success" onclick="triggerCustomWebhook()">
              <span class="btn-icon">ğŸš€</span>
              <span class="btn-text">Deploy from GitHub</span>
            </button>
            <button class="action-btn secondary" onclick="triggerSampleWebhook()">
              <span class="btn-icon">ğŸ§ª</span>
              <span class="btn-text">Test with Sample</span>
            </button>
          </div>

          <div id="webhook-status" class="status-message"></div>
        </div>
      </section>

      <!-- Container Status Section -->
      <section class="section">
        <div class="section-header">
          <h2>ğŸ“¦ Container Status</h2>
          <p class="section-subtitle">Monitor and manage your containers</p>
        </div>
        <div id="status" class="containers-list">Loading containers...</div>
      </section>

      <!-- Logs Section -->
      <section class="section">
        <div class="section-header">
          <h2>ğŸ“ Advanced Logging</h2>
          <p class="section-subtitle">Real-time container activity with filtering and search</p>
        </div>
        
        <div class="logs-controls">
          <div class="logs-filter-group">
            <input 
              type="text" 
              id="log-search" 
              class="form-input" 
              placeholder="Search logs..."
            >
            <select id="log-container-filter" class="form-input">
              <option value="">All Containers</option>
            </select>
            <select id="log-type-filter" class="form-input">
              <option value="">All Types</option>
              <option value="error">Errors</option>
              <option value="warning">Warnings</option>
              <option value="info">Info</option>
            </select>
          </div>
          
          <div class="logs-actions">
            <button class="action-btn secondary" onclick="refreshLogs()">
              <span class="btn-icon">ğŸ”„</span>
              <span class="btn-text">Refresh</span>
            </button>
            <button class="action-btn secondary" onclick="exportLogs('json')">
              <span class="btn-icon">ğŸ’¾</span>
              <span class="btn-text">Export JSON</span>
            </button>
            <button class="action-btn secondary" onclick="exportLogs('csv')">
              <span class="btn-icon">ğŸ“Š</span>
              <span class="btn-text">Export CSV</span>
            </button>
            <button class="action-btn secondary" onclick="clearAllLogs()">
              <span class="btn-icon">ğŸ§¹</span>
              <span class="btn-text">Clear</span>
            </button>
          </div>
        </div>
        
        <div class="logs-container">
          <pre id="logs">Loading logs...</pre>
        </div>
        
        <div class="logs-pagination">
          <button class="mini-btn" onclick="previousLogsPage()" id="prev-logs-btn">â† Previous</button>
          <span id="logs-page-info">Page 1</span>
          <button class="mini-btn" onclick="nextLogsPage()" id="next-logs-btn">Next â†’</button>
        </div>
      </section>

      <!-- Container Networking Section -->
      <section class="section">
        <div class="section-header">
          <h2>ğŸŒ Container Networking</h2>
          <p class="section-subtitle">Port mappings, network connections, and traffic information</p>
        </div>
        
        <div class="network-actions">
          <button class="action-btn secondary" onclick="refreshNetworking()">
            <span class="btn-icon">ğŸ”„</span>
            <span class="btn-text">Refresh Network</span>
          </button>
          <button class="action-btn secondary" onclick="toggleNetworkDetails()">
            <span class="btn-icon">ğŸ“Š</span>
            <span class="btn-text">Network Stats</span>
          </button>
        </div>
        
        <div id="network-stats" class="network-stats" style="display: none;">
          <div class="stats-row">
            <div class="stat-item">
              <span class="stat-label">Total Containers</span>
              <span class="stat-value" id="net-total-containers">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">With Ports</span>
              <span class="stat-value" id="net-containers-ports">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Total Ports</span>
              <span class="stat-value" id="net-total-ports">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Networks</span>
              <span class="stat-value" id="net-unique-networks">0</span>
            </div>
          </div>
        </div>
        
        <div id="network-info" class="network-grid">Loading network information...</div>
      </section>

      <!-- Add Container Registry Management Section -->
      <section class="section">
        <div class="section-header">
          <h2>ğŸ“¦ Container Registry</h2>
          <p class="section-subtitle">Manage images, search registries, and pull/push containers</p>
        </div>
        
        <div class="registry-tabs">
          <button class="tab-btn active" onclick="switchRegistryTab('local')">
            <span class="tab-icon">ğŸ’¾</span>
            <span class="tab-text">Local Images</span>
          </button>
          <button class="tab-btn" onclick="switchRegistryTab('search')">
            <span class="tab-icon">ğŸ”</span>
            <span class="tab-text">Search Registry</span>
          </button>
          <button class="tab-btn" onclick="switchRegistryTab('manage')">
            <span class="tab-icon">âš™ï¸</span>
            <span class="tab-text">Manage</span>
          </button>
        </div>
        
        <!-- Local Images Tab -->
        <div id="local-images-tab" class="registry-tab active">
          <div class="registry-actions">
            <button class="action-btn secondary" onclick="refreshLocalImages()">
              <span class="btn-icon">ğŸ”„</span>
              <span class="btn-text">Refresh</span>
            </button>
            <button class="action-btn secondary" onclick="toggleImageDetails()">
              <span class="btn-icon">ğŸ“Š</span>
              <span class="btn-text">Details</span>
            </button>
          </div>
          
          <div id="local-images-list" class="images-grid">Loading local images...</div>
        </div>
        
        <!-- Search Registry Tab -->
        <div id="search-registry-tab" class="registry-tab">
          <div class="search-form">
            <div class="form-group">
              <label for="image-search-input">Search Docker Hub</label>
              <div class="search-input-group">
                <input 
                  type="text" 
                  id="image-search-input" 
                  class="form-input" 
                  placeholder="e.g., nginx, postgres, python"
                >
                <button class="action-btn primary" onclick="searchRegistry()">
                  <span class="btn-icon">ğŸ”</span>
                  <span class="btn-text">Search</span>
                </button>
              </div>
              <div class="form-hint">Search for images in Docker Hub and other registries</div>
            </div>
          </div>
          
          <div id="search-results" class="images-grid">Enter a search query to find images</div>
        </div>
        
        <!-- Manage Images Tab -->
        <div id="manage-images-tab" class="registry-tab">
          <div class="manage-form">
            <div class="form-group">
              <label for="pull-image-input">Pull Image</label>
              <div class="input-group">
                <input 
                  type="text" 
                  id="pull-image-input" 
                  class="form-input" 
                  placeholder="e.g., nginx:latest, postgres:15"
                >
                <button class="action-btn success" onclick="pullImage()">
                  <span class="btn-icon">â¬‡ï¸</span>
                  <span class="btn-text">Pull</span>
                </button>
              </div>
              <div class="form-hint">Enter the full image name with optional tag</div>
            </div>
            
            <div class="form-group">
              <label for="tag-source-input">Tag Image</label>
              <div class="tag-inputs">
                <input 
                  type="text" 
                  id="tag-source-input" 
                  class="form-input" 
                  placeholder="Source image"
                >
                <span class="tag-arrow">â†’</span>
                <input 
                  type="text" 
                  id="tag-target-input" 
                  class="form-input" 
                  placeholder="Target image"
                >
                <button class="action-btn secondary" onclick="tagImage()">
                  <span class="btn-icon">ğŸ·ï¸</span>
                  <span class="btn-text">Tag</span>
                </button>
              </div>
              <div class="form-hint">Create a new tag for an existing image</div>
            </div>
          </div>
          
          <div id="manage-status" class="status-message"></div>
        </div>
      </section>

      <!-- Health Monitoring Section -->
      <section class="section">
        <div class="section-header">
          <h2>ğŸ’š Health Monitoring</h2>
          <p class="section-subtitle">Container performance and resource usage</p>
        </div>
        <div class="health-actions">
          <button class="action-btn secondary" onclick="refreshHealth()">
            <span class="btn-icon">ğŸ“Š</span>
            <span class="btn-text">Refresh Health</span>
          </button>
          <button class="action-btn success" onclick="startHealthMonitoring()">
            <span class="btn-icon">ğŸ”„</span>
            <span class="btn-text">Auto-Refresh</span>
          </button>
          <button class="action-btn warning" onclick="stopHealthMonitoring()">
            <span class="btn-icon">â¹ï¸</span>
            <span class="btn-text">Stop</span>
          </button>
        </div>
        <div id="health-status" class="health-grid">Loading health data...</div>
      </section>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <p>&copy; 2025 AutoPod. Intelligent Container Management System.</p>
    </footer>
  </div>

  <script>
    // Splash screen animation
    window.addEventListener('load', function() {
      const splashScreen = document.getElementById('splash-screen');
      setTimeout(() => {
        splashScreen.classList.add('fade-out');
        setTimeout(() => {
          splashScreen.style.display = 'none';
        }, 800);
      }, 2000);
    });

    let lastUpdateTime = null;
    let healthMonitorInterval = null;

    function getStatusBadge(status) {
      const statusLower = status.toLowerCase();
      if (statusLower.includes('running') || statusLower.includes('up')) {
        return 'badge-running';
      } else if (statusLower.includes('exited') || statusLower.includes('stopped')) {
        return 'badge-stopped';
      } else if (statusLower.includes('created')) {
        return 'badge-created';
      } else if (statusLower.includes('paused')) {
        return 'badge-paused';
      } else {
        return 'badge-unknown';
      }
    }

    function getStatusText(status) {
      const statusLower = status.toLowerCase();
      if (statusLower.includes('running') || statusLower.includes('up')) {
        return 'Running';
      } else if (statusLower.includes('exited') || statusLower.includes('stopped')) {
        return 'Stopped';
      } else if (statusLower.includes('created')) {
        return 'Created';
      } else if (statusLower.includes('paused')) {
        return 'Paused';
      } else {
        return status;
      }
    }

    function updateLastUpdated() {
      lastUpdateTime = new Date();
      const lastUpdatedDiv = document.getElementById('last-updated');
      lastUpdatedDiv.textContent = `Last updated: ${lastUpdateTime.toLocaleTimeString()}`;
    }

    // Container Management Functions
    async function startContainer(containerName) {
      const statusDiv = document.getElementById('sync-status');
      statusDiv.className = 'status-message info';
      statusDiv.innerHTML = `Starting container: ${containerName}...`;
      
      try {
        const response = await fetch('/api/containers/start', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ container_name: containerName })
        });
        
        const result = await response.json();
        if (result.success) {
          statusDiv.className = 'status-message success';
          statusDiv.innerHTML = `âœ… Container ${containerName} started successfully`;
          setTimeout(fetchData, 2000);
        } else {
          statusDiv.className = 'status-message error';
          statusDiv.innerHTML = `âŒ Failed to start ${containerName}: ${result.error}`;
        }
      } catch (err) {
        statusDiv.className = 'status-message error';
        statusDiv.innerHTML = `âŒ Error starting container: ${err.message}`;
      }
    }

    async function stopContainer(containerName) {
      const statusDiv = document.getElementById('sync-status');
      statusDiv.className = 'status-message info';
      statusDiv.innerHTML = `Stopping container: ${containerName}...`;
      
      try {
        const response = await fetch('/api/containers/stop', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ container_name: containerName })
        });
        
        const result = await response.json();
        if (result.success) {
          statusDiv.className = 'status-message success';
          statusDiv.innerHTML = `âœ… Container ${containerName} stopped successfully`;
          setTimeout(fetchData, 2000);
        } else {
          statusDiv.className = 'status-message error';
          statusDiv.innerHTML = `âŒ Failed to stop ${containerName}: ${result.error}`;
        }
      } catch (err) {
        statusDiv.className = 'status-message error';
        statusDiv.innerHTML = `âŒ Error stopping container: ${err.message}`;
      }
    }

    async function restartContainer(containerName) {
      const statusDiv = document.getElementById('sync-status');
      statusDiv.className = 'status-message info';
      statusDiv.innerHTML = `Restarting container: ${containerName}...`;
      
      try {
        const response = await fetch('/api/containers/restart', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ container_name: containerName })
        });
        
        const result = await response.json();
        if (result.success) {
          statusDiv.className = 'status-message success';
          statusDiv.innerHTML = `âœ… Container ${containerName} restarted successfully`;
          setTimeout(fetchData, 2000);
        } else {
          statusDiv.className = 'status-message error';
          statusDiv.innerHTML = `âŒ Failed to restart ${containerName}: ${result.error}`;
        }
      } catch (err) {
        statusDiv.className = 'status-message error';
        statusDiv.innerHTML = `âŒ Error restarting container: ${err.message}`;
      }
    }

    async function removeContainer(containerName) {
      if (!confirm(`Are you sure you want to remove container ${containerName}?`)) {
        return;
      }
      
      const statusDiv = document.getElementById('sync-status');
      statusDiv.className = 'status-message info';
      statusDiv.innerHTML = `Removing container: ${containerName}...`;
      
      try {
        const response = await fetch('/api/containers/remove', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ container_name: containerName })
        });
        
        const result = await response.json();
        if (result.success) {
          statusDiv.className = 'status-message success';
          statusDiv.innerHTML = `âœ… Container ${containerName} removed successfully`;
          setTimeout(fetchData, 2000);
        } else {
          statusDiv.className = 'status-message error';
          statusDiv.innerHTML = `âŒ Failed to remove ${containerName}: ${result.error}`;
        }
      } catch (err) {
        statusDiv.className = 'status-message error';
        statusDiv.innerHTML = `âŒ Error removing container: ${err.message}`;
      }
    }

    // Sync and Refresh Functions
    async function syncContainers() {
      const statusDiv = document.getElementById('sync-status');
      statusDiv.className = 'status-message info';
      statusDiv.innerHTML = 'Syncing containers with database...';
      
      try {
        const response = await fetch('/api/sync', { 
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });
        const result = await response.json();
        
        if (result.success) {
          statusDiv.className = 'status-message success';
          statusDiv.innerHTML = 'âœ… Sync successful! Refreshing data...';
          setTimeout(fetchData, 1000);
        } else {
          statusDiv.className = 'status-message error';
          statusDiv.innerHTML = `âŒ Sync failed: ${result.error}`;
        }
      } catch (err) {
        statusDiv.className = 'status-message error';
        statusDiv.innerHTML = `âŒ Sync error: ${err.message}`;
      }
      
      setTimeout(() => {
        statusDiv.innerHTML = '';
        statusDiv.className = 'status-message';
      }, 5000);
    }

    function refreshData() {
      fetchData();
    }

    function clearLogs() {
      const logsPre = document.getElementById('logs');
      logsPre.textContent = 'Logs cleared. New logs will appear here...';
    }

    // Webhook Functions
    async function triggerCustomWebhook() {
      const githubUrl = document.getElementById('github-url').value;
      const appName = document.getElementById('app-name').value || 'auto-deployed-app';
      const statusDiv = document.getElementById('webhook-status');
      
      if (!githubUrl) {
        statusDiv.className = 'status-message error';
        statusDiv.innerHTML = 'âŒ Please enter a GitHub repository URL';
        return;
      }

      statusDiv.className = 'status-message info';
      statusDiv.innerHTML = `ğŸš€ Deploying from GitHub: ${githubUrl}`;
      
      try {
        const response = await fetch('/webhook', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            repository: {
              clone_url: githubUrl,
              name: appName
            },
            after: "auto-deploy-" + Date.now()
          })
        });
        
        const result = await response.json();
        if (result.status === 'success') {
          statusDiv.className = 'status-message success';
          statusDiv.innerHTML = 'âœ… Deployment started! Container will appear shortly.';
          setTimeout(fetchData, 3000);
        } else {
          statusDiv.className = 'status-message error';
          statusDiv.innerHTML = `âŒ Deployment failed: ${result.message}`;
        }
      } catch (err) {
        statusDiv.className = 'status-message error';
        statusDiv.innerHTML = `âŒ Deployment error: ${err.message}`;
      }
    }

    async function triggerSampleWebhook() {
      const statusDiv = document.getElementById('webhook-status');
      statusDiv.className = 'status-message info';
      statusDiv.innerHTML = 'ğŸš€ Triggering sample webhook deployment...';
      
      try {
        const response = await fetch('/webhook', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            repository: {
              clone_url: "https://github.com/nginx/nginx.git",
              name: "sample-auto-app"
            },
            after: "sample-deploy-" + Date.now()
          })
        });
        
        const result = await response.json();
        if (result.status === 'success') {
          statusDiv.className = 'status-message success';
          statusDiv.innerHTML = 'âœ… Sample deployment started! Check for new containers.';
          setTimeout(fetchData, 3000);
        } else {
          statusDiv.className = 'status-message error';
          statusDiv.innerHTML = `âŒ Sample deployment failed: ${result.message}`;
        }
      } catch (err) {
        statusDiv.className = 'status-message error';
        statusDiv.innerHTML = `âŒ Sample deployment error: ${err.message}`;
      }
    }

    function getRepoNameFromUrl(url) {
      try {
        const match = url.match(/github\.com\/([^\/]+\/[^\/]+?)(?:\.git)?$/);
        return match ? match[1].replace('/', '-') : 'github-app';
      } catch {
        return 'github-app';
      }
    }

    document.getElementById('github-url').addEventListener('input', function(e) {
      const url = e.target.value;
      const appNameInput = document.getElementById('app-name');
      if (url && !appNameInput.value) {
        appNameInput.value = getRepoNameFromUrl(url);
      }
    });

    async function testWebhook() {
      const statusDiv = document.getElementById('sync-status');
      statusDiv.className = 'status-message info';
      statusDiv.innerHTML = 'Testing webhook functionality...';
      
      try {
        const response = await fetch('/webhook', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ test: "simple webhook test" })
        });
        
        const result = await response.json();
        if (result.status === 'success') {
          statusDiv.className = 'status-message success';
          statusDiv.innerHTML = 'âœ… Webhook test successful! Check for new containers.';
          setTimeout(fetchData, 3000);
        } else {
          statusDiv.className = 'status-message error';
          statusDiv.innerHTML = `âŒ Webhook test failed: ${result.message}`;
        }
      } catch (err) {
        statusDiv.className = 'status-message error';
        statusDiv.innerHTML = `âŒ Webhook test error: ${err.message}`;
      }
    }

    // Main Data Fetching Function
    async function fetchData() {
      try {
        const [statusRes, logsRes] = await Promise.all([
          fetch('http://127.0.0.1:5000/api/status'),
          fetch('http://127.0.0.1:5000/api/logs')
        ]);

        const statusData = await statusRes.json();
        const logsData = await logsRes.json();

        const statusDiv = document.getElementById('status');
        
        // Update stats
        let runningCount = 0;
        let stoppedCount = 0;
        let issueCount = 0;
        
        if (statusData.success && statusData.data.length > 0) {
          document.getElementById('total-containers').textContent = statusData.data.length;
          
          statusData.data.forEach(container => {
            const status = container['status'].toLowerCase();
            if (status.includes('running') || status.includes('up')) {
              runningCount++;
            } else if (status.includes('exited') || status.includes('stopped')) {
              stoppedCount++;
            } else {
              issueCount++;
            }
          });
          
          document.getElementById('running-containers').textContent = runningCount;
          document.getElementById('stopped-containers').textContent = stoppedCount;
          document.getElementById('issue-containers').textContent = issueCount;
          
          statusDiv.innerHTML = `
            <div class="containers-grid">
              ${statusData.data.map(container => `
                <div class="container-card">
                  <div class="container-header">
                    <div class="container-name">${container['container_name']}</div>
                    <span class="status-badge ${getStatusBadge(container['status'])}">
                      ${getStatusText(container['status'])}
                    </span>
                  </div>
                  <div class="container-details">
                    <div class="detail-item">
                      <span class="detail-label">Status:</span>
                      <span class="detail-value">${container['status']}</span>
                    </div>
                    <div class="detail-item">
                      <span class="detail-label">Created:</span>
                      <span class="detail-value">${new Date(container['created_at']).toLocaleString()}</span>
                    </div>
                  </div>
                  <div class="container-actions">
                    <button class="mini-btn success" onclick="startContainer('${container['container_name']}')" 
                            ${container['status'].toLowerCase().includes('running') ? 'disabled' : ''}>
                      <span class="desc-icon">â–¶ï¸</span>
                      <span class="desc-text">Start</span>
                    </button>
                    <button class="mini-btn warning" onclick="stopContainer('${container['container_name']}')"
                            ${!container['status'].toLowerCase().includes('running') ? 'disabled' : ''}>
                      <span class="desc-icon">â¹ï¸</span>
                      <span class="desc-text">Stop</span>
                    </button>
                    <button class="mini-btn" onclick="restartContainer('${container['container_name']}')"
                            ${!container['status'].toLowerCase().includes('running') ? 'disabled' : ''}>
                      <span class="desc-icon">ğŸ”„</span>
                      <span class="desc-text">Restart</span>
                    </button>
                    <button class="mini-btn danger" onclick="removeContainer('${container['container_name']}')">
                      <span class="desc-icon">ğŸ—‘ï¸</span>
                      <span class="desc-text">Remove</span>
                    </button>
                  </div>
                </div>
              `).join('')}
            </div>
          `;
        } else {
          document.getElementById('total-containers').textContent = '0';
          document.getElementById('running-containers').textContent = '0';
          document.getElementById('stopped-containers').textContent = '0';
          document.getElementById('issue-containers').textContent = '0';
          statusDiv.innerHTML = '<div class="empty-state">No containers found. Click "Sync Containers" to refresh or "Test Webhook" to deploy a sample container.</div>';
        }

        const logsPre = document.getElementById('logs');
        if (logsData.success && logsData.data.length > 0) {
          logsPre.textContent = logsData.data.map(log => 
            `[${log['timestamp']}] ${log['container_name'] || 'unknown'}: ${log['log']}`
          ).join('\n');
          logsPre.scrollTop = logsPre.scrollHeight;
        } else {
          logsPre.textContent = 'No logs available. Start containers or trigger a webhook to see logs.';
        }

        updateLastUpdated();

      } catch (err) {
        console.error('Error fetching data:', err);
        document.getElementById('status').innerHTML = '<div class="empty-state error">Error loading container status. Check if the server is running.</div>';
        document.getElementById('logs').textContent = 'Error loading logs. Check console for details.';
        document.getElementById('total-containers').textContent = '0';
        
        const statusDiv = document.getElementById('sync-status');
        statusDiv.className = 'status-message error';
        statusDiv.innerHTML = 'âŒ Connection error. Make sure the backend server is running on port 5000.';
      }
    }

    fetchData();
    setInterval(fetchData, 5000);
    updateLastUpdated();

    // Health Monitoring Functions
    async function refreshHealth() {
      const healthContainer = document.getElementById('health-status');
      
      try {
        const response = await fetch('/api/containers/health');
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        
        if (result.success && result.data) {
          displayHealthData(result.data);
        } else {
          healthContainer.innerHTML = `<div class="empty-state error">Error loading health data: ${result.error || 'Unknown error'}</div>`;
        }
      } catch (err) {
        healthContainer.innerHTML = `<div class="empty-state error">Network error: ${err.message}</div>`;
      }
    }

    function displayHealthData(healthData) {
      const healthContainer = document.getElementById('health-status');
      
      if (!healthData || Object.keys(healthData).length === 0) {
        healthContainer.innerHTML = '<div class="empty-state">No containers found for health monitoring.</div>';
        return;
      }
      
      let html = '';
      
      Object.entries(healthData).forEach(([containerName, data]) => {
        const health = data.health || {};
        const resources = data.resources || {};
        const basicInfo = data.basic_info || {};
        
        const healthStatus = health.status || 'unknown';
        const healthColor = getHealthStatusColor(healthStatus);
        const healthIcon = getHealthStatusIcon(healthStatus);
        const cpuUsage = resources.cpu_percent || '0%';
        const memoryUsage = resources.memory_usage || '0B';
        const memoryLimit = resources.memory_limit || 'N/A';
        const networkIO = resources.network_io || '0B / 0B';
        const restartCount = resources.restart_count || 0;
        const pids = resources.pids || '0';
        const createdDate = resources.created_at || basicInfo.created || 'unknown';
        
        let displayDate = createdDate;
        if (typeof createdDate === 'number' && createdDate > 1000000000) {
          displayDate = new Date(createdDate * 1000).toLocaleString();
        }
        
        const isInferred = health.inferred;

        html += `
          <div class="health-card" style="border-left: 4px solid ${healthColor};">
            <div class="health-header">
              <div class="health-title">
                <span class="health-icon">${healthIcon}</span>
                <h3>${containerName}</h3>
              </div>
              <div class="health-badges">
                <span class="health-status-badge" style="background-color: ${healthColor};">
                  ${healthStatus.toUpperCase()}
                </span>
                ${isInferred ? `<span class="health-inferred-badge">INFERRED</span>` : ''}
              </div>
            </div>
            
            <div class="health-info">
              <div class="info-item">ğŸ“¦ ${basicInfo.image || 'unknown'}</div>
              <div class="info-item">ğŸ”„ ${basicInfo.status || 'unknown'}</div>
              <div class="info-item">ğŸ•’ ${displayDate}</div>
            </div>
            
            <div class="metrics-grid">
              <div class="metric">
                <div class="metric-label">ğŸ’» CPU</div>
                <div class="metric-value" style="color: ${getUsageColor(cpuUsage)};">${cpuUsage}</div>
              </div>
              <div class="metric">
                <div class="metric-label">ğŸ§  Memory</div>
                <div class="metric-value" style="color: ${getUsageColor(memoryUsage)};">${memoryUsage} / ${memoryLimit}</div>
              </div>
              <div class="metric">
                <div class="metric-label">ğŸŒ Network</div>
                <div class="metric-value">${networkIO}</div>
              </div>
              <div class="metric">
                <div class="metric-label">ğŸ”„ Restarts</div>
                <div class="metric-value" style="color: ${restartCount > 0 ? '#f59e0b' : '#10b981'};">${restartCount}</div>
              </div>
              <div class="metric">
                <div class="metric-label">âŒ Failures</div>
                <div class="metric-value" style="color: ${health.failures > 0 ? '#ef4444' : '#10b981'};">${health.failures || 0}</div>
              </div>
              <div class="metric">
                <div class="metric-label">ğŸ“Š Processes</div>
                <div class="metric-value">${pids}</div>
              </div>
            </div>
            
            <div class="health-actions">
              <button class="mini-btn success" onclick="startContainer('${containerName}')"
                      ${basicInfo.status && basicInfo.status.toLowerCase().includes('running') ? 'disabled' : ''}>
                â–¶ï¸ Start
              </button>
              <button class="mini-btn warning" onclick="restartContainer('${containerName}')"
                      ${!(basicInfo.status && basicInfo.status.toLowerCase().includes('running')) ? 'disabled' : ''}>
                ğŸ”„ Restart
              </button>
            </div>
          </div>
        `;
      });
      
      healthContainer.innerHTML = html;
    }

    function getHealthStatusIcon(status) {
      const statusLower = status.toLowerCase();
      if (statusLower === 'healthy' || statusLower === 'running') return 'âœ…';
      if (statusLower === 'unhealthy' || statusLower === 'exited') return 'âŒ';
      if (statusLower === 'starting' || statusLower === 'created') return 'ğŸ”„';
      return 'â“';
    }

    function getHealthStatusColor(status) {
      const statusLower = status.toLowerCase();
      if (statusLower === 'healthy' || statusLower === 'running') return '#10b981';
      if (statusLower === 'unhealthy' || statusLower === 'exited') return '#ef4444';
      if (statusLower === 'starting' || statusLower === 'created') return '#3b82f6';
      return '#94a3b8';
    }

    function getUsageColor(usage) {
      if (typeof usage === 'string') {
        const percentMatch = usage.match(/(\d+\.?\d*)%/);
        if (percentMatch) {
          const percent = parseFloat(percentMatch[1]);
          if (percent > 80) return '#ef4444';
          if (percent > 60) return '#f59e0b';
          return '#10b981';
        }
      }
      return '#06b6d4';
    }

    function startHealthMonitoring() {
      if (healthMonitorInterval) {
        clearInterval(healthMonitorInterval);
      }
      healthMonitorInterval = setInterval(refreshHealth, 3000);
      refreshHealth();
    }

    function stopHealthMonitoring() {
      if (healthMonitorInterval) {
        clearInterval(healthMonitorInterval);
        healthMonitorInterval = null;
      }
    }

    // Network Monitoring Functions
    async function refreshNetworking() {
      const networkContainer = document.getElementById('network-info');
      
      try {
        const response = await fetch('/api/containers/network/all');
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        
        if (result.success && result.data) {
          displayNetworkInfo(result.data);
        } else {
          networkContainer.innerHTML = `<div class="empty-state error">Error loading network data: ${result.error || 'Unknown error'}</div>`;
        }
      } catch (err) {
        networkContainer.innerHTML = `<div class="empty-state error">Network error: ${err.message}</div>`;
      }
    }
    
    function displayNetworkInfo(networkData) {
      const networkContainer = document.getElementById('network-info');
      
      if (!networkData || Object.keys(networkData).length === 0) {
        networkContainer.innerHTML = '<div class="empty-state">No containers found for network monitoring.</div>';
        return;
      }
      
      let html = '';
      
      Object.entries(networkData).forEach(([containerName, data]) => {
        const ports = data.ports || [];
        const networks = data.networks || [];
        const hostname = data.hostname || 'N/A';
        const ipAddress = data.ip_address || 'N/A';
        const gateway = data.gateway || 'N/A';
        const macAddress = data.mac_address || 'N/A';
        const dnsServers = data.dns_servers || [];
        
        html += `
          <div class="network-card">
            <div class="network-header">
              <div class="network-title">
                <span class="network-icon">ğŸŒ</span>
                <h3>${containerName}</h3>
              </div>
              <div class="network-badge">
                ${ports.length > 0 ? `<span class="badge-ports">${ports.length} Port${ports.length !== 1 ? 's' : ''}</span>` : '<span class="badge-no-ports">No Ports</span>'}
              </div>
            </div>
            
            <div class="network-details">
              <div class="detail-row">
                <span class="detail-label">Hostname:</span>
                <span class="detail-value">${hostname}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">IP Address:</span>
                <span class="detail-value">${ipAddress}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Gateway:</span>
                <span class="detail-value">${gateway}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">MAC Address:</span>
                <span class="detail-value">${macAddress}</span>
              </div>
            </div>
            
            ${ports.length > 0 ? `
              <div class="ports-section">
                <h4>Port Mappings</h4>
                <div class="ports-list">
                  ${ports.map(port => `
                    <div class="port-item">
                      <div class="port-mapping">
                        <span class="port-container">${port.container_port}</span>
                        <span class="port-arrow">â†’</span>
                        <span class="port-host">${port.host_ip}:${port.host_port}</span>
                      </div>
                      <a href="${port.url}" target="_blank" class="port-link">
                        <span class="link-icon">ğŸ”—</span>
                        Open
                      </a>
                    </div>
                  `).join('')}
                </div>
              </div>
            ` : ''}
            
            ${networks.length > 0 ? `
              <div class="networks-section">
                <h4>Networks</h4>
                <div class="networks-list">
                  ${networks.map(net => `
                    <div class="network-item">
                      <div class="network-name">${net.name}</div>
                      <div class="network-info-row">
                        <span class="info-label">IP:</span>
                        <span class="info-value">${net.ip_address}</span>
                      </div>
                      <div class="network-info-row">
                        <span class="info-label">Gateway:</span>
                        <span class="info-value">${net.gateway}</span>
                      </div>
                    </div>
                  `).join('')}
                </div>
              </div>
            ` : ''}
            
            ${dnsServers.length > 0 ? `
              <div class="dns-section">
                <h4>DNS Servers</h4>
                <div class="dns-list">
                  ${dnsServers.map(dns => `<span class="dns-item">${dns}</span>`).join('')}
                </div>
              </div>
            ` : ''}
          </div>
        `;
      });
      
      networkContainer.innerHTML = html;
    }
    
    async function updateNetworkStats() {
      try {
        const response = await fetch('/api/network/stats');
        const result = await response.json();
        
        if (result.success && result.data) {
          const stats = result.data;
          document.getElementById('net-total-containers').textContent = stats.total_containers;
          document.getElementById('net-containers-ports').textContent = stats.containers_with_ports;
          document.getElementById('net-total-ports').textContent = stats.total_ports_exposed;
          document.getElementById('net-unique-networks').textContent = stats.unique_networks;
        }
      } catch (err) {
        console.error('Error fetching network stats:', err);
      }
    }
    
    function toggleNetworkDetails() {
      const statsDiv = document.getElementById('network-stats');
      if (statsDiv.style.display === 'none') {
        statsDiv.style.display = 'block';
        updateNetworkStats();
      } else {
        statsDiv.style.display = 'none';
      }
    }

    // Container Registry Management Functions
    function switchRegistryTab(tabName) {
      // Hide all tabs
      document.querySelectorAll('.registry-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Remove active class from all buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected tab
      const tabId = `${tabName}-images-tab`;
      if (tabName === 'search') {
        document.getElementById('search-registry-tab').classList.add('active');
      } else if (tabName === 'manage') {
        document.getElementById('manage-images-tab').classList.add('active');
      } else {
        document.getElementById('local-images-tab').classList.add('active');
      }
      
      // Add active class to clicked button
      event.target.closest('.tab-btn').classList.add('active');
      
      if (tabName === 'local') {
        refreshLocalImages();
      }
    }
    
    async function refreshLocalImages() {
      const imagesList = document.getElementById('local-images-list');
      imagesList.innerHTML = 'Loading local images...';
      
      try {
        const response = await fetch('/api/images');
        const result = await response.json();
        
        if (result.success && result.data) {
          displayLocalImages(result.data);
        } else {
          imagesList.innerHTML = `<div class="empty-state error">Error loading images: ${result.error || 'Unknown error'}</div>`;
        }
      } catch (err) {
        imagesList.innerHTML = `<div class="empty-state error">Network error: ${err.message}</div>`;
      }
    }
    
    function displayLocalImages(images) {
      const imagesList = document.getElementById('local-images-list');
      
      if (!images || images.length === 0) {
        imagesList.innerHTML = '<div class="empty-state">No local images found. Pull an image to get started.</div>';
        return;
      }
      
      let html = '';
      
      images.forEach(image => {
        const fullName = image.full_name || `${image.repository}:${image.tag}`;
        const imageId = image.image_id || 'unknown';
        const size = image.size || 'N/A';
        const created = image.created || 'unknown';
        
        html += `
          <div class="image-card">
            <div class="image-header">
              <div class="image-name">${fullName}</div>
              <div class="image-id">ID: ${imageId}</div>
            </div>
            
            <div class="image-info">
              <div class="info-row">
                <span class="info-label">Size:</span>
                <span class="info-value">${size}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Created:</span>
                <span class="info-value">${created}</span>
              </div>
            </div>
            
            <div class="image-actions">
              <button class="mini-btn success" onclick="runContainerFromImage('${fullName}')">
                <span class="btn-icon">â–¶ï¸</span>
                <span class="btn-text">Run</span>
              </button>
              <button class="mini-btn secondary" onclick="viewImageHistory('${fullName}')">
                <span class="btn-icon">ğŸ“œ</span>
                <span class="btn-text">History</span>
              </button>
              <button class="mini-btn warning" onclick="pushImageToRegistry('${fullName}')">
                <span class="btn-icon">â¬†ï¸</span>
                <span class="btn-text">Push</span>
              </button>
              <button class="mini-btn danger" onclick="removeLocalImage('${fullName}')">
                <span class="btn-icon">ğŸ—‘ï¸</span>
                <span class="btn-text">Remove</span>
              </button>
            </div>
          </div>
        `;
      });
      
      imagesList.innerHTML = html;
    }
    
    async function searchRegistry() {
      const searchInput = document.getElementById('image-search-input');
      const query = searchInput.value.trim();
      const resultsList = document.getElementById('search-results');
      
      if (!query) {
        resultsList.innerHTML = '<div class="empty-state">Enter a search query</div>';
        return;
      }
      
      resultsList.innerHTML = 'Searching registry...';
      
      try {
        const response = await fetch(`/api/images/search?q=${encodeURIComponent(query)}&limit=25`);
        const result = await response.json();
        
        if (result.success && result.data) {
          displaySearchResults(result.data);
        } else {
          resultsList.innerHTML = `<div class="empty-state error">Error searching: ${result.error || 'Unknown error'}</div>`;
        }
      } catch (err) {
        resultsList.innerHTML = `<div class="empty-state error">Network error: ${err.message}</div>`;
      }
    }
    
    function displaySearchResults(results) {
      const resultsList = document.getElementById('search-results');
      
      if (!results || results.length === 0) {
        resultsList.innerHTML = '<div class="empty-state">No images found</div>';
        return;
      }
      
      let html = '';
      
      results.forEach(result => {
        const name = result.Name || result.name || 'unknown';
        const description = result.Description || result.description || 'No description';
        const stars = result.Stars || result.stars || 0;
        const official = result.Official || result.official || false;
        const automated = result.Automated || result.automated || false;
        
        html += `
          <div class="search-result-card">
            <div class="result-header">
              <div class="result-name">${name}</div>
              <div class="result-badges">
                ${official ? '<span class="badge-official">Official</span>' : ''}
                ${automated ? '<span class="badge-automated">Automated</span>' : ''}
              </div>
            </div>
            
            <div class="result-description">${description}</div>
            
            <div class="result-stats">
              <span class="stat">â­ ${stars} stars</span>
            </div>
            
            <div class="result-actions">
              <button class="action-btn success" onclick="pullImageFromSearch('${name}')">
                <span class="btn-icon">â¬‡ï¸</span>
                <span class="btn-text">Pull</span>
              </button>
            </div>
          </div>
        `;
      });
      
      resultsList.innerHTML = html;
    }
    
    async function pullImage() {
      const imageName = document.getElementById('pull-image-input').value.trim();
      const statusDiv = document.getElementById('manage-status');
      
      if (!imageName) {
        statusDiv.className = 'status-message error';
        statusDiv.innerHTML = 'Please enter an image name';
        return;
      }
      
      statusDiv.className = 'status-message info';
      statusDiv.innerHTML = `Pulling image: ${imageName}...`;
      
      try {
        const response = await fetch('/api/images/pull', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ image_name: imageName })
        });
        
        const result = await response.json();
        if (result.success) {
          statusDiv.className = 'status-message success';
          statusDiv.innerHTML = `âœ… Image pulled successfully: ${imageName}`;
          document.getElementById('pull-image-input').value = '';
          setTimeout(refreshLocalImages, 2000);
        } else {
          statusDiv.className = 'status-message error';
          statusDiv.innerHTML = `âŒ Failed to pull image: ${result.error}`;
        }
      } catch (err) {
        statusDiv.className = 'status-message error';
        statusDiv.innerHTML = `âŒ Error: ${err.message}`;
      }
    }
    
    async function pullImageFromSearch(imageName) {
      const statusDiv = document.getElementById('manage-status');
      statusDiv.className = 'status-message info';
      statusDiv.innerHTML = `Pulling image: ${imageName}...`;
      
      try {
        const response = await fetch('/api/images/pull', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ image_name: imageName })
        });
        
        const result = await response.json();
        if (result.success) {
          statusDiv.className = 'status-message success';
          statusDiv.innerHTML = `âœ… Image pulled successfully: ${imageName}`;
          setTimeout(refreshLocalImages, 2000);
        } else {
          statusDiv.className = 'status-message error';
          statusDiv.innerHTML = `âŒ Failed to pull image: ${result.error}`;
        }
      } catch (err) {
        statusDiv.className = 'status-message error';
        statusDiv.innerHTML = `âŒ Error: ${err.message}`;
      }
    }
    
    async function tagImage() {
      const sourceImage = document.getElementById('tag-source-input').value.trim();
      const targetImage = document.getElementById('tag-target-input').value.trim();
      const statusDiv = document.getElementById('manage-status');
      
      if (!sourceImage || !targetImage) {
        statusDiv.className = 'status-message error';
        statusDiv.innerHTML = 'Please enter both source and target image names';
        return;
      }
      
      statusDiv.className = 'status-message info';
      statusDiv.innerHTML = `Tagging image: ${sourceImage} -> ${targetImage}...`;
      
      try {
        const response = await fetch('/api/images/tag', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ source_image: sourceImage, target_image: targetImage })
        });
        
        const result = await response.json();
        if (result.success) {
          statusDiv.className = 'status-message success';
          statusDiv.innerHTML = `âœ… Image tagged successfully`;
          document.getElementById('tag-source-input').value = '';
          document.getElementById('tag-target-input').value = '';
          setTimeout(refreshLocalImages, 2000);
        } else {
          statusDiv.className = 'status-message error';
          statusDiv.innerHTML = `âŒ Failed to tag image: ${result.error}`;
        }
      } catch (err) {
        statusDiv.className = 'status-message error';
        statusDiv.innerHTML = `âŒ Error: ${err.message}`;
      }
    }
    
    async function removeLocalImage(imageName) {
      if (!confirm(`Are you sure you want to remove image ${imageName}?`)) {
        return;
      }
      
      const statusDiv = document.getElementById('manage-status');
      statusDiv.className = 'status-message info';
      statusDiv.innerHTML = `Removing image: ${imageName}...`;
      
      try {
        const response = await fetch('/api/images/remove', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ image_name: imageName })
        });
        
        const result = await response.json();
        if (result.success) {
          statusDiv.className = 'status-message success';
          statusDiv.innerHTML = `âœ… Image removed successfully`;
          setTimeout(refreshLocalImages, 2000);
        } else {
          statusDiv.className = 'status-message error';
          statusDiv.innerHTML = `âŒ Failed to remove image: ${result.error}`;
        }
      } catch (err) {
        statusDiv.className = 'status-message error';
        statusDiv.innerHTML = `âŒ Error: ${err.message}`;
      }
    }
    
    async function viewImageHistory(imageName) {
      try {
        const response = await fetch(`/api/images/${encodeURIComponent(imageName)}/history`);
        const result = await response.json();
        
        if (result.success && result.data) {
          let historyText = `Image History for ${imageName}:\n\n`;
          result.data.forEach((layer, index) => {
            historyText += `Layer ${index + 1}:\n`;
            historyText += `  ID: ${layer.ID || 'N/A'}\n`;
            historyText += `  Created: ${layer.Created || 'N/A'}\n`;
            historyText += `  Size: ${layer.Size || 'N/A'}\n`;
            historyText += `  Command: ${layer.CreatedBy || 'N/A'}\n\n`;
          });
          alert(historyText);
        } else {
          alert('Failed to fetch image history');
        }
      } catch (err) {
        alert(`Error: ${err.message}`);
      }
    }
    
    function runContainerFromImage(imageName) {
      const containerName = prompt(`Enter container name for ${imageName}:`, imageName.replace(':', '-'));
      if (containerName) {
        runContainer(imageName, containerName);
      }
    }
    
    function pushImageToRegistry(imageName) {
      const registry = prompt('Enter registry URL (leave empty for Docker Hub):', '');
      if (registry !== null) {
        pushImage(imageName, registry);
      }
    }
    
    async function pushImage(imageName, registry) {
      const statusDiv = document.getElementById('manage-status');
      statusDiv.className = 'status-message info';
      statusDiv.innerHTML = `Pushing image: ${imageName}...`;
      
      try {
        const response = await fetch('/api/images/push', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ image_name: imageName, registry: registry || null })
        });
        
        const result = await response.json();
        if (result.success) {
          statusDiv.className = 'status-message success';
          statusDiv.innerHTML = `âœ… Image pushed successfully`;
        } else {
          statusDiv.className = 'status-message error';
          statusDiv.innerHTML = `âŒ Failed to push image: ${result.error}`;
        }
      } catch (err) {
        statusDiv.className = 'status-message error';
        statusDiv.innerHTML = `âŒ Error: ${err.message}`;
      }
    }
    
    function toggleImageDetails() {
      // This can be expanded to show more detailed image information
      alert('Image details feature coming soon!');
    }

    let currentLogsPage = 0;
    const logsPerPage = 50;
    let allLogs = [];
    
    async function fetchAdvancedLogs() {
      try {
        const searchQuery = document.getElementById('log-search').value;
        const containerFilter = document.getElementById('log-container-filter').value;
        const typeFilter = document.getElementById('log-type-filter').value;
        
        const params = new URLSearchParams({
          limit: logsPerPage,
          offset: currentLogsPage * logsPerPage,
          ...(searchQuery && { search: searchQuery }),
          ...(containerFilter && { container: containerFilter }),
          ...(typeFilter && { type: typeFilter })
        });
        
        const response = await fetch(`/api/logs/advanced?${params}`);
        const result = await response.json();
        
        if (result.success) {
          allLogs = result.data;
          displayLogs(result.data);
          updateLogsPageInfo(result.total);
        }
      } catch (err) {
        console.error('Error fetching advanced logs:', err);
      }
    }
    
    function displayLogs(logs) {
      const logsPre = document.getElementById('logs');
      if (logs.length > 0) {
        logsPre.textContent = logs.map(log => 
          `[${log['timestamp']}] ${log['container_name'] || 'system'}: ${log['log']}`
        ).join('\n');
        logsPre.scrollTop = logsPre.scrollHeight;
      } else {
        logsPre.textContent = 'No logs found matching your filters.';
      }
    }
    
    function updateLogsPageInfo(total) {
      const pageInfo = document.getElementById('logs-page-info');
      const totalPages = Math.ceil(total / logsPerPage);
      pageInfo.textContent = `Page ${currentLogsPage + 1} of ${totalPages || 1}`;
      
      document.getElementById('prev-logs-btn').disabled = currentLogsPage === 0;
      document.getElementById('next-logs-btn').disabled = currentLogsPage >= totalPages - 1;
    }
    
    function nextLogsPage() {
      currentLogsPage++;
      fetchAdvancedLogs();
    }
    
    function previousLogsPage() {
      if (currentLogsPage > 0) {
        currentLogsPage--;
        fetchAdvancedLogs();
      }
    }
    
    function refreshLogs() {
      currentLogsPage = 0;
      fetchAdvancedLogs();
    }
    
    async function exportLogs(format) {
      try {
        const containerFilter = document.getElementById('log-container-filter').value;
        const params = new URLSearchParams({
          format: format,
          ...(containerFilter && { container: containerFilter })
        });
        
        const response = await fetch(`/api/logs/export?${params}`);
        const blob = await response.blob();
        
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `logs.${format === 'csv' ? 'csv' : 'json'}`;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
      } catch (err) {
        console.error('Error exporting logs:', err);
        alert('Failed to export logs');
      }
    }
    
    function clearAllLogs() {
      if (confirm('Are you sure you want to clear all logs?')) {
        document.getElementById('logs').textContent = 'Logs cleared.';
        currentLogsPage = 0;
      }
    }
    
    // Update container filter dropdown
    function updateContainerFilter() {
      const select = document.getElementById('log-container-filter');
      const currentValue = select.value;
      select.innerHTML = '<option value="">All Containers</option>';
      
      // Add unique container names from status data
      const statusDiv = document.getElementById('status');
      const containerNames = new Set();
      
      document.querySelectorAll('.container-name').forEach(el => {
        containerNames.add(el.textContent);
      });
      
      containerNames.forEach(name => {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        select.appendChild(option);
      });
      
      select.value = currentValue;
    }
    
    // Add event listeners for filtering
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('log-search').addEventListener('input', () => {
        currentLogsPage = 0;
        fetchAdvancedLogs();
      });
      
      document.getElementById('log-container-filter').addEventListener('change', () => {
        currentLogsPage = 0;
        fetchAdvancedLogs();
      });
      
      document.getElementById('log-type-filter').addEventListener('change', () => {
        currentLogsPage = 0;
        fetchAdvancedLogs();
      });
      
      fetchAdvancedLogs();
      setInterval(() => {
        updateContainerFilter();
        fetchAdvancedLogs();
      }, 5000);
    });

    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(refreshHealth, 1000);
      refreshNetworking();
      setInterval(refreshNetworking, 10000);
    });
  </script>
</body>
</html>
